import { ref } from 'vue'; // Keep watch for local effects that are still needed here
import { useI18n } from 'vue-i18n';
import { v4 as uuidv4 } from 'uuid'; // Import v4 for uuid generation
import { useSendMessageMutation } from '@/composables/ai/mutations/useSendMessageMutation'; // NEW
import type { AiChatMessage, ChatAttachmentDto, ChatLocation } from '@/types'; // Import the new message type and ChatAttachmentDto, ChatLocation
import type { UploadedFile } from '../chat/useChatInput'; // Import UploadedFile

// Define dependencies for useAiChat composable
interface UseAiChatDeps {
  useSendMessageMutation: typeof useSendMessageMutation;
}

const defaultAiChatDeps: UseAiChatDeps = {
  useSendMessageMutation: useSendMessageMutation,
};

export function useAiChat(familyId: string, deps: UseAiChatDeps = defaultAiChatDeps) {
  const { useSendMessageMutation } = deps;
  const { t } = useI18n();
  const sessionId = uuidv4(); // Generate a session ID once per chat session
  const messages = ref<AiChatMessage[]>([
    {
      sender: 'ai', text: t('aiChat.welcomeMessage')
    },
    // {
    //   sender: 'user', text: "test",
    //   attachments: [
    //     {
    //       "url": "https://i.ibb.co/0RSfqj54/fce9077ef705.jpg",
    //       "contentType": "image/jpeg"
    //     }
    //   ]
    // }
    // {
    //   sender: 'ai',
    //   text: "Đã hoàn thành nhận dạng hình ảnh. Tìm thấy tổng cộng 2 khuôn mặt. Trong đó, 2 khuôn mặt được nhận dạng là thành viên gia đình.",
    //   intent: 'IMAGE_RECOGNITION_PAGE',
    //   faceDetectionResults: [
    //     {
    //       "imageId": "8aa2f4e8-b781-40b5-a3e0-920654c63435",
    //       "originalImageUrl": "https://i.ibb.co/KcWTmfjY/62e182f31434.jpg",
    //       "resizedImageUrl": null,
    //       "detectedFaces": [
    //         {
    //           "id": "56ac4fc8-f68f-4061-9a4f-37b759e79558",
    //           "boundingBox": {
    //             "x": 1141,
    //             "y": 146,
    //             "width": 90,
    //             "height": 91
    //           },
    //           "confidence": 0.99,
    //           "thumbnail": "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",
    //           "thumbnailUrl": undefined,
    //           "memberId": "06bd09f3-c876-4e81-851e-0a0c4620a2dc",
    //           "memberName": "Huỳnh Kim Thảo",
    //           "familyId": "28908399-d379-40fd-b4fc-ab95480ea0a2",
    //           "familyName": "Huỳnh",
    //           "birthYear": 1990,
    //           "deathYear": undefined,
    //           "embedding": [
    //             0.0026481144595891237,
    //             0.09466167539358139,
    //             -0.008571001701056957,
    //             0.09365002065896988,
    //             0.03814074024558067,
    //             0.005113006103783846,
    //             -0.03746285289525986,
    //             0.028317663818597794,
    //             -0.06954426318407059,
    //             0.01676074229180813,
    //             0.058262381702661514,
    //             -0.0415789820253849,
    //             -0.08715933561325073,
    //             -0.05528826639056206,
    //             -0.017369937151670456,
    //             -0.008939423598349094,
    //             0.02928859367966652,
    //             0.06624431908130646,
    //             -0.049991708248853683,
    //             0.034773800522089005,
    //             0.026006504893302917,
    //             0.05673686042428017,
    //             -0.011703078635036945,
    //             -0.060824520885944366,
    //             -0.019052797928452492,
    //             -0.03690437600016594,
    //             0.08006533235311508,
    //             0.012512540444731712,
    //             0.010550027713179588,
    //             0.03682125732302666,
    //             -0.0014046006835997105,
    //             0.05605937913060188,
    //             -0.015889756381511688,
    //             0.07112930715084076,
    //             0.012952174991369247,
    //             -0.04832019656896591,
    //             0.004003009293228388,
    //             -0.1444142907857895,
    //             0.0043132007122039795,
    //             -0.016308434307575226,
    //             -0.006846003700047731,
    //             0.012205707840621471,
    //             0.04900232329964638,
    //             -0.002725639147683978,
    //             0.020275717601180077,
    //             0.018503637984395027,
    //             -0.021461566910147667,
    //             0.007371925748884678,
    //             0.010724593885242939,
    //             0.023630749434232712,
    //             -0.000383066653739661,
    //             -0.0656735971570015,
    //             0.1322585791349411,
    //             0.049152273684740067,
    //             0.0637301504611969,
    //             -0.04715728759765625,
    //             -0.05621066689491272,
    //             0.08290067315101624,
    //             0.047049105167388916,
    //             -0.0067352112382650375,
    //             0.06733500957489014,
    //             0.008420296013355255,
    //             0.030395643785595894,
    //             -0.0011502290144562721,
    //             0.011101697571575642,
    //             0.014690177515149117,
    //             -0.031112831085920334,
    //             0.021281380206346512,
    //             0.0464622862637043,
    //             0.006519115995615721,
    //             -0.0579642690718174,
    //             0.011322340928018093,
    //             -0.011028934270143509,
    //             0.057344600558280945,
    //             0.0659182146191597,
    //             -0.001439965795725584,
    //             -0.044338442385196686,
    //             -0.02305479533970356,
    //             0.027398383244872093,
    //             0.010815577581524849,
    //             0.06473567336797714,
    //             0.00779679324477911,
    //             -0.04275567829608917,
    //             -0.018586885184049606,
    //             0.004640808328986168,
    //             0.013682172633707523,
    //             -0.0017521058907732368,
    //             0.0016401000320911407,
    //             0.056205227971076965,
    //             -0.001819003839045763,
    //             -0.01661575399339199,
    //             0.024621058255434036,
    //             0.011018776334822178,
    //             -0.03594692423939705,
    //             -0.021094778552651405,
    //             0.07591076195240021,
    //             0.03014434687793255,
    //             0.10206956416368484,
    //             -0.011173931881785393,
    //             0.02673158049583435,
    //             0.003103888127952814,
    //             0.030720015987753868,
    //             -0.024800606071949005,
    //             -0.023260248824954033,
    //             0.001043633557856083,
    //             -0.018519943580031395,
    //             0.060887932777404785,
    //             -0.06777869164943695,
    //             -0.025690604001283646,
    //             -0.019486458972096443,
    //             0.07622120529413223,
    //             -0.009728500619530678,
    //             0.014888478443026543,
    //             -0.0680445209145546,
    //             -0.008431872352957726,
    //             0.029211929067969322,
    //             -0.018727513030171394,
    //             0.0023628161288797855,
    //             -0.03956844285130501,
    //             0.04233931750059128,
    //             -0.03301185369491577,
    //             0.05408158153295517,
    //             0.00834398902952671,
    //             0.04577639698982239,
    //             -0.006705088075250387,
    //             -0.028449254110455513,
    //             0.10001561790704727,
    //             -0.07264545559883118,
    //             0.024570323526859283,
    //             0.003780439728870988,
    //             -0.012639752589166164,
    //             -0.03083663061261177,
    //             0.03618381544947624,
    //             -0.038398854434490204,
    //             0.006910032592713833,
    //             0.004774140194058418,
    //             0.014985146000981331,
    //             -0.007552598137408495,
    //             -0.023783398792147636,
    //             0.0721663385629654,
    //             0.03162530064582825,
    //             0.008834248408675194,
    //             -0.08726458251476288,
    //             0.01125538069754839,
    //             -0.0010195361683145165,
    //             0.02452390268445015,
    //             -0.03260152414441109,
    //             0.012562504969537258,
    //             0.023697489872574806,
    //             0.026628384366631508,
    //             0.027973337098956108,
    //             0.03450766205787659,
    //             -0.09933281689882278,
    //             0.006509263534098864,
    //             0.021671932190656662,
    //             -0.01114742923527956,
    //             -0.08261473476886749,
    //             -0.039969440549612045,
    //             -0.07737347483634949,
    //             -0.014838563278317451,
    //             0.06181271746754646,
    //             0.021241813898086548,
    //             0.0390140600502491,
    //             0.04928768053650856,
    //             -0.04075201228260994,
    //             0.001583457225933671,
    //             -0.07091642916202545,
    //             0.06480357050895691,
    //             -0.0263981893658638,
    //             0.021241208538413048,
    //             -0.02785290591418743,
    //             -0.008840606547892094,
    //             0.009351146407425404,
    //             0.02791605517268181,
    //             -0.027962801977992058,
    //             0.06118341162800789,
    //             -0.03243036940693855,
    //             0.044384486973285675,
    //             -0.024022730067372322,
    //             -0.0037066075019538403,
    //             -0.015220042318105698,
    //             -0.01730787567794323,
    //             0.045989759266376495,
    //             0.005916137248277664,
    //             0.04166483134031296,
    //             0.011924626305699348,
    //             0.05056659132242203,
    //             -0.007663946598768234,
    //             0.04922427982091904,
    //             0.09065099060535431,
    //             0.0051972693763673306,
    //             0.030114520341157913,
    //             0.058403514325618744,
    //             -0.0162558164447546,
    //             0.03739045560359955,
    //             -0.019479665905237198,
    //             -0.06210796907544136,
    //             -0.0583127923309803,
    //             0.028523802757263184,
    //             -0.04044383391737938,
    //             0.02633962221443653,
    //             -0.04124755412340164,
    //             0.02998468279838562,
    //             0.0038855301681905985,
    //             0.06793007999658585,
    //             -0.03854398429393768,
    //             -0.0033724470995366573,
    //             -0.0022473640274256468,
    //             -0.07369964569807053,
    //             0.06945184618234634,
    //             0.007902813144028187,
    //             0.01544831320643425,
    //             0.057548340409994125,
    //             0.0027407431043684483,
    //             -0.08454733341932297,
    //             0.12202145159244537,
    //             0.04133288189768791,
    //             0.01122999470680952,
    //             -0.05642252042889595,
    //             -0.03195720538496971,
    //             -0.03052532486617565,
    //             0.02019861899316311,
    //             0.030218997970223427,
    //             0.07217218726873398,
    //             0.09883423894643784,
    //             0.06343448162078857,
    //             0.040458641946315765,
    //             0.03255332633852959,
    //             0.04526791721582413,
    //             0.051380377262830734,
    //             0.06180916726589203,
    //             -0.033640485256910324,
    //             -0.007969160564243793,
    //             -0.02201670967042446,
    //             -0.021766051650047302,
    //             -0.004888973664492369,
    //             -0.0727105587720871,
    //             0.045008402317762375,
    //             0.025053048506379128,
    //             0.05125930532813072,
    //             -0.020944008603692055,
    //             0.00763530982658267,
    //             -0.027926774695515633,
    //             0.011760277673602104,
    //             0.09441318362951279,
    //             0.02840183489024639,
    //             -0.04031872749328613,
    //             -0.07037370651960373,
    //             0.11730636656284332,
    //             -0.05978931114077568,
    //             -0.061464883387088776,
    //             0.03475994989275932,
    //             -0.012864387594163418,
    //             -0.05031650885939598,
    //             0.04482240229845047,
    //             -0.04735952615737915,
    //             -0.01498155202716589,
    //             0.07975256443023682,
    //             0.06815236061811447,
    //             -0.007099036127328873,
    //             -0.02316346950829029,
    //             -0.016700955107808113,
    //             0.052465058863162994,
    //             -0.033357713371515274,
    //             -0.0003181349893566221,
    //             -0.06797202676534653,
    //             -0.020266523584723473,
    //             0.05118398740887642,
    //             0.013666986487805843,
    //             -0.09562664479017258,
    //             0.03662632033228874,
    //             0.006733893416821957,
    //             0.024163207039237022,
    //             0.022539488971233368,
    //             0.035359401255846024,
    //             0.07771937549114227,
    //             -0.0003893159737344831,
    //             0.04771512374281883,
    //             0.004015888553112745,
    //             0.045360248535871506,
    //             0.029845047742128372,
    //             0.05423630028963089,
    //             -0.030117031186819077,
    //             -0.019791249185800552,
    //             -0.01967098005115986,
    //             -0.009661303833127022,
    //             0.022608106955885887,
    //             -0.0010833375854417682,
    //             -0.05235131084918976,
    //             0.07668834924697876,
    //             -0.06851045787334442,
    //             -0.002982945879921317,
    //             -0.030949417501688004,
    //             0.012938187457621098,
    //             -0.023463215678930283,
    //             0.027555741369724274,
    //             -0.03458252176642418,
    //             -0.027582282200455666,
    //             -0.04892508313059807,
    //             -0.017779305577278137,
    //             0.060782138258218765,
    //             0.03316216170787811,
    //             -0.011382333934307098,
    //             0.06950879842042923,
    //             0.05654755234718323,
    //             0.026433059945702553,
    //             0.0736287459731102,
    //             -0.021759971976280212,
    //             -0.09298866242170334,
    //             -0.017112279310822487,
    //             -0.022908711805939674,
    //             0.03189152479171753,
    //             0.04504596069455147,
    //             0.024740207940340042,
    //             0.08469100296497345,
    //             0.005310020409524441,
    //             -0.0474528931081295,
    //             -0.026400679722428322,
    //             0.06880307197570801,
    //             0.0021200377959758043,
    //             0.025375235825777054,
    //             -0.04264840856194496,
    //             -0.004366776440292597,
    //             0.062103256583213806,
    //             0.062310975044965744,
    //             -0.06496954709291458,
    //             0.06720702350139618,
    //             0.009579528123140335,
    //             -0.035673730075359344,
    //             0.049777232110500336,
    //             0.013991782441735268,
    //             0.029353437945246696,
    //             -0.05949975550174713,
    //             0.02476397715508938,
    //             -0.007512431591749191,
    //             0.07098093628883362,
    //             0.00969988014549017,
    //             -0.055364836007356644,
    //             0.030188580974936485,
    //             -0.07938650995492935,
    //             0.08187609165906906,
    //             0.017507661134004593,
    //             0.030423637479543686,
    //             -0.0029376596212387085,
    //             -0.010630028322339058,
    //             0.030753204599022865,
    //             -0.008017773739993572,
    //             0.0240729209035635,
    //             -0.004940340295433998,
    //             0.019265756011009216,
    //             -0.0196615532040596,
    //             -0.02074810303747654,
    //             0.014867587015032768,
    //             0.026816779747605324,
    //             0.009882151149213314,
    //             0.06252754479646683,
    //             0.014948452822864056,
    //             0.0419277586042881,
    //             0.002064712345600128,
    //             -0.009050972759723663,
    //             -0.02622968703508377,
    //             -0.07683434337377548,
    //             -0.033449675887823105,
    //             -0.028930533677339554,
    //             0.026713883504271507,
    //             0.014806345105171204,
    //             -0.08844143152236938,
    //             -0.03839242458343506,
    //             -0.07819953560829163,
    //             0.02993719093501568,
    //             -0.006419752724468708,
    //             -0.015656469389796257,
    //             -0.03991624712944031,
    //             -0.028467701748013496,
    //             -0.011140812188386917,
    //             0.11200929433107376,
    //             -0.038723815232515335,
    //             0.02349473349750042,
    //             -0.0213084127753973,
    //             0.043433163315057755,
    //             -0.014145474880933762,
    //             -0.0007815502467565238,
    //             0.023533165454864502,
    //             -0.049958448857069016,
    //             0.02893129549920559,
    //             0.007496125064790249,
    //             0.0327119454741478,
    //             0.028202595189213753,
    //             0.016910357400774956,
    //             0.0995040163397789,
    //             -0.04831727594137192,
    //             0.030509280040860176,
    //             -0.047638095915317535,
    //             -0.013527593575417995,
    //             -0.0049737426452338696,
    //             0.02053457871079445,
    //             -0.013971880078315735,
    //             0.05176730453968048,
    //             0.0281106885522604,
    //             -0.014339263550937176,
    //             -0.0011726128868758678,
    //             -0.04913995787501335,
    //             0.0339834950864315,
    //             -0.0400397852063179,
    //             0.00941687636077404,
    //             -0.004318107385188341,
    //             -0.06259851157665253,
    //             -0.012441991828382015,
    //             0.06079665571451187,
    //             0.02467571385204792,
    //             0.08119488507509232,
    //             -0.02894391305744648,
    //             -0.007855820469558239,
    //             0.003966873977333307,
    //             -0.07253129780292511,
    //             -0.051503296941518784,
    //             -0.002742316573858261,
    //             0.05904555320739746,
    //             0.008301819674670696,
    //             0.011700350791215897,
    //             0.01913348212838173,
    //             -0.015764286741614342,
    //             0.05245889350771904,
    //             -0.0013551636366173625,
    //             0.0166995357722044,
    //             0.020066505298018456,
    //             0.023801222443580627,
    //             0.009242217987775803,
    //             0.02117227576673031,
    //             -0.05102116987109184,
    //             -0.05305110290646553,
    //             -0.003931550309062004,
    //             0.007045942824333906,
    //             -0.09151667356491089,
    //             0.02959241159260273,
    //             -0.04544724151492119,
    //             -0.04484150931239128,
    //             -0.06762891262769699,
    //             -0.0045601073652505875,
    //             -0.023419607430696487,
    //             -0.056965991854667664,
    //             -0.0007206376758404076,
    //             -0.07960458844900131,
    //             0.055101897567510605,
    //             -0.0453043058514595,
    //             0.05520538240671158,
    //             -0.028749847784638405,
    //             0.06896193325519562,
    //             0.02190832793712616,
    //             -0.11924385279417038,
    //             0.11594013124704361,
    //             -0.08717285096645355,
    //             0.014497230760753155,
    //             -0.015056058764457703,
    //             -0.0442933663725853,
    //             -0.027625244110822678,
    //             -0.0061768521554768085,
    //             0.015205180272459984,
    //             0.06977928429841995,
    //             0.064725860953331,
    //             0.011212539859116077,
    //             0.06294198334217072,
    //             -0.0025376626290380955,
    //             0.02987476997077465,
    //             -0.00802773516625166,
    //             0.0714840218424797,
    //             0.05891011282801628,
    //             -0.0945468470454216,
    //             0.052587155252695084,
    //             0.011235520243644714,
    //             -0.023165645077824593,
    //             0.0032943631522357464,
    //             -0.005207323469221592,
    //             -0.06792471557855606,
    //             -0.02823016792535782,
    //             0.025845550000667572,
    //             -0.048302896320819855,
    //             0.010694789700210094,
    //             0.02964787185192108,
    //             0.002718165749683976,
    //             0.01634516380727291,
    //             0.051298800855875015,
    //             0.006656360346823931,
    //             0.04735448211431503,
    //             -0.029881972819566727,
    //             -0.13386809825897217,
    //             -0.00752432132139802,
    //             0.05262795835733414,
    //             0.01811332069337368,
    //             -0.06839726120233536,
    //             -0.020819876343011856,
    //             -0.008612759411334991,
    //             -0.062496285885572433,
    //             0.017605841159820557,
    //             -0.005542654078453779,
    //             -0.014984440058469772,
    //             0.06493975967168808,
    //             0.0509614497423172,
    //             0.07853700965642929,
    //             0.0353286936879158,
    //             -0.03239894658327103,
    //             0.03770279884338379,
    //             0.005436427891254425,
    //             0.007715301122516394,
    //             -0.0723043829202652,
    //             -0.015224452130496502,
    //             0.02856050245463848,
    //             -0.04841998964548111,
    //             -0.0001587141159689054,
    //             -0.05206618085503578,
    //             0.042886506766080856,
    //             0.007481460925191641
    //           ],
    //           "emotion": "Happy",
    //           "emotionConfidence": undefined,
    //           "status": "recognized"
    //         }
    //       ]
    //     }
    //   ]
    // }

  ])

  const {
    mutate: sendAiMessageMutation,
    isPending: isSendingMessage,
  } = useSendMessageMutation();

  const sendMessage = async (messageText: string, attachments?: UploadedFile[], location?: ChatLocation) => {
    const chatAttachments: ChatAttachmentDto[] | undefined = attachments?.map(att => ({
      url: att.url,
      contentType: att.type,
    }));

    messages.value.push({ sender: 'user', text: messageText, attachments: chatAttachments, location: location }); // Include attachments and location

    sendAiMessageMutation(
      { familyId, sessionId, chatInput: messageText, attachments: chatAttachments, location: location },
      {
        onSuccess: (responseAiMessage) => {
          messages.value.push(responseAiMessage);
        },
        onError: (error) => {
          console.error('AI chat error:', error);
          messages.value.push({ sender: 'ai', text: 'Xin lỗi, tôi gặp sự cố. Vui lòng thử lại sau.' });
        },
      }
    );
  };

  return {
    messages,
    loading: isSendingMessage,
    sendMessage,
  };
}